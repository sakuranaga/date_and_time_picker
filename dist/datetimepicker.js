!function(t){"use strict";!function(t,e){void 0===e&&(e={});var a=e.insertAt;if("undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===a&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(':root{--dp-primary-color:#06c;--dp-sunday-color:#d63638;--dp-saturday-color:#06c;--dp-bg-color:#fff;--dp-text-color:#333;--dp-hover-bg:#f0f0f0;--dp-border-radius:8px;--dp-shadow:0 4px 20px rgba(0,0,0,.15)}.date-input-container{margin-bottom:20px}.date-input{background-color:#fff;background-image:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="%23666" stroke-width="1.5" fill="none"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8"  y1="2" x2="8"  y2="6"/><line x1="3"  y1="10" x2="21" y2="10"/></svg>\');background-position:right 10px center;background-repeat:no-repeat;background-size:14px 14px;border:1px solid #ccc;border-radius:4px;cursor:pointer;font-size:14px;padding:8px 32px 8px 12px;width:200px}.date-picker-wrapper{display:inline-block;position:relative}.date-picker{background:var(--dp-bg-color);border-radius:var(--dp-border-radius);box-shadow:var(--dp-shadow);display:none;left:0;margin-top:4px;padding:12px;position:absolute;top:100%;width:280px;z-index:1000}.date-picker.show{display:block}.date-picker-controls{align-items:center;display:flex;justify-content:space-between;margin-bottom:12px;position:relative}.month-navigation{align-items:center;display:flex;gap:4px;left:50%;position:absolute;transform:translateX(-50%)}.clear-button,.today-button{background:#e6f2ff;border:none;border-radius:4px;color:var(--dp-primary-color);cursor:pointer;font-size:11px;padding:4px 12px;transition:background-color .2s}.today-button{margin-left:auto}.clear-button:hover:not(:disabled),.today-button:hover{background-color:#cce5ff}.clear-button:disabled{background:#f5f5f5;color:#aaa;cursor:default}.nav-button{align-items:center;background:transparent;border:none;border-radius:4px;color:var(--dp-text-color);cursor:pointer;display:flex;flex-shrink:0;font-size:16px;height:24px;justify-content:center;opacity:.6;transition:background-color .2s;width:24px}.nav-button:hover{background-color:var(--dp-hover-bg)}.month-year-display{color:var(--dp-text-color);font-size:14px;font-weight:500;text-align:center;white-space:nowrap}.calendar-day.sunday:not(.other-month),.weekday-header.sunday{color:var(--dp-sunday-color)}.calendar-day.saturday:not(.other-month),.weekday-header.saturday{color:var(--dp-saturday-color)}.calendar-grid{display:grid;gap:2px;grid-template-columns:repeat(7,1fr)}.weekday-header{color:var(--dp-text-color);font-size:11px;font-weight:500;opacity:.6;padding:4px 0;text-align:center}.calendar-day{align-items:center;aspect-ratio:1;background:transparent;border:none;border-radius:50%;color:var(--dp-text-color);cursor:pointer;display:flex;font-size:13px;justify-content:center;min-height:32px;padding:0;position:relative;transition:all .2s}.calendar-day:hover:not(.other-month):not(.selected){background-color:var(--dp-hover-bg)}.calendar-day.other-month{color:var(--dp-text-color);opacity:.3}.calendar-day.disabled,.calendar-day.disabled.saturday,.calendar-day.disabled.sunday{color:var(--dp-text-color);cursor:not-allowed;opacity:.3;pointer-events:none}.calendar-day.disabled:hover{background-color:transparent}.calendar-day.selected{background-color:var(--dp-primary-color);color:#fff;font-weight:500}.calendar-day.selected.sunday{background-color:var(--dp-sunday-color);color:#fff}.calendar-day.selected.saturday{color:#fff}.calendar-day.holiday:not(.other-month){color:var(--dp-sunday-color)}.calendar-day.holiday.selected{background-color:var(--dp-sunday-color);color:#fff}.calendar-day.disabled.holiday{color:var(--dp-text-color);opacity:.3}.calendar-day.today:not(.selected){font-weight:600}.calendar-day.today:not(.selected).sunday{color:var(--dp-sunday-color)}.calendar-day.today:not(.selected).saturday{color:var(--dp-saturday-color)}.calendar-day.today:not(.selected):after{background-color:currentColor;border-radius:50%;bottom:2px;content:"";height:3px;left:50%;position:absolute;transform:translateX(-50%);width:3px}.dp-overlay{display:none;inset:0;position:fixed;z-index:999}.dp-overlay.show{display:block}.date-picker.dp-datetime{width:auto}.dp-datetime-body{display:flex;gap:12px}.dp-calendar-section{flex-shrink:0;width:256px}.dp-time-section{flex-shrink:0}.dp-time-container{display:flex;gap:8px;height:240px}.dp-time-column{flex:1;min-width:52px;overflow-x:hidden;overflow-y:auto;padding:4px;scroll-behavior:smooth}.dp-time-column::-webkit-scrollbar{width:6px}.dp-time-column::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.dp-time-column::-webkit-scrollbar-thumb{background:#ccc;border-radius:3px}.dp-time-column::-webkit-scrollbar-thumb:hover{background:#999}.dp-time-item{border-radius:6px;cursor:pointer;font-size:13px;padding:6px 8px;text-align:center;transition:all .2s;user-select:none}.dp-time-item:hover{background-color:var(--dp-hover-bg)}.dp-time-item.selected{background-color:var(--dp-primary-color);color:#fff;font-weight:500}.date-picker.dp-time-only{width:180px}.dp-time-only .dp-time-container{height:200px}@media (max-width:768px){.date-picker{padding:10px;width:260px}.date-picker.dp-datetime{width:auto}.dp-datetime-body{flex-direction:column}.dp-calendar-section{width:100%}.dp-time-container{height:160px}.calendar-day{font-size:12px;min-height:28px}.nav-button{font-size:14px;height:20px;width:20px}.month-year-display{font-size:13px}.today-button{font-size:10px;padding:3px 8px}}');class e{static instances=[];constructor(t,a={}){this.wrapper=t,this.input=t.querySelector(".date-input"),this.config={format:"YYYY/MM/DD",mode:"date",minuteStep:30,minDate:null,maxDate:null,...a},this.minDate=this.parseDate(this.config.minDate),this.maxDate=this.parseDate(this.config.maxDate),this.holidays=a.holidays instanceof Set?a.holidays:new Set(a.holidays||[]),this.selectedDate=null,this.viewDate=new Date,this.selectedHour=null,this.selectedMinute=null,e.instances.push(this),this.init()}parseDate(t){if(!t)return null;if("today"===t){const t=new Date;return t.setHours(0,0,0,0),t}if(t instanceof Date)return t;const e=String(t).match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(e)return new Date(parseInt(e[1]),parseInt(e[2])-1,parseInt(e[3]));const a=new Date(t);return isNaN(a)?null:a}isDisabled(t){const e=new Date(t);if(e.setHours(0,0,0,0),this.minDate){const t=new Date(this.minDate);if(t.setHours(0,0,0,0),e<t)return!0}if(this.maxDate){const t=new Date(this.maxDate);if(t.setHours(0,0,0,0),e>t)return!0}return!1}init(){this.createPicker(),this.attachEventListeners()}createPicker(){const t=document.createElement("div");t.className="date-picker",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-label","DateTime Picker");const e=this.config.mode;"time"===e?(t.classList.add("dp-time-only"),t.innerHTML='\n                <div class="dp-time-container">\n                    <div class="dp-time-column dp-hour-column" role="listbox" aria-label="Hours"></div>\n                    <div class="dp-time-column dp-minute-column" role="listbox" aria-label="Minutes"></div>\n                </div>\n            '):"datetime"===e?(t.classList.add("dp-datetime"),t.innerHTML='\n                <div class="date-picker-controls">\n                    <button type="button" class="clear-button" disabled>クリア</button>\n                    <div class="month-navigation">\n                        <button type="button" class="nav-button prev-month" aria-label="Previous Month">‹</button>\n                        <div class="month-year-display" aria-live="polite"></div>\n                        <button type="button" class="nav-button next-month" aria-label="Next Month">›</button>\n                    </div>\n                    <button type="button" class="today-button">今日</button>\n                </div>\n                <div class="dp-datetime-body">\n                    <div class="dp-calendar-section">\n                        <div class="calendar-grid" role="grid"></div>\n                    </div>\n                    <div class="dp-time-section">\n                        <div class="dp-time-container">\n                            <div class="dp-time-column dp-hour-column" role="listbox" aria-label="Hours"></div>\n                            <div class="dp-time-column dp-minute-column" role="listbox" aria-label="Minutes"></div>\n                        </div>\n                    </div>\n                </div>\n            '):t.innerHTML='\n                <div class="date-picker-controls">\n                    <button type="button" class="clear-button" disabled>クリア</button>\n                    <div class="month-navigation">\n                        <button type="button" class="nav-button prev-month" aria-label="Previous Month">‹</button>\n                        <div class="month-year-display" aria-live="polite"></div>\n                        <button type="button" class="nav-button next-month" aria-label="Next Month">›</button>\n                    </div>\n                    <button type="button" class="today-button">今日</button>\n                </div>\n                <div class="calendar-grid" role="grid"></div>\n            ',this.wrapper.appendChild(t),this.picker=t,this.monthYearDisplay=t.querySelector(".month-year-display"),this.calendarGrid=t.querySelector(".calendar-grid"),this.prevButton=t.querySelector(".prev-month"),this.nextButton=t.querySelector(".next-month"),this.todayButton=t.querySelector(".today-button"),this.clearButton=t.querySelector(".clear-button"),this.hourColumn=t.querySelector(".dp-hour-column"),this.minuteColumn=t.querySelector(".dp-minute-column"),"time"!==e&&"datetime"!==e||this.generateTimeOptions(),this.createOverlay()}generateTimeOptions(){let t="";for(let e=0;e<24;e++){const a=e.toString().padStart(2,"0");t+=`<div class="dp-time-item dp-hour-item" data-value="${a}" role="option" tabindex="-1">${a}</div>`}this.hourColumn.innerHTML=t;let e="";for(let t=0;t<60;t+=this.config.minuteStep){const a=t.toString().padStart(2,"0");e+=`<div class="dp-time-item dp-minute-item" data-value="${a}" role="option" tabindex="-1">${a}</div>`}this.minuteColumn.innerHTML=e}selectHour(t){this.selectedHour=t,this.hourColumn.querySelectorAll(".dp-hour-item").forEach(e=>{const a=e.dataset.value===t;e.classList.toggle("selected",a),e.setAttribute("aria-selected",a)}),this.setInputValue()}selectMinute(t){this.selectedMinute=t,this.minuteColumn.querySelectorAll(".dp-minute-item").forEach(e=>{const a=e.dataset.value===t;e.classList.toggle("selected",a),e.setAttribute("aria-selected",a)}),this.setInputValue()}scrollToTimeSelection(t){const e=t.querySelector(".selected");e&&(t.scrollTop=e.offsetTop-t.offsetTop-t.clientHeight/2+e.clientHeight/2)}createOverlay(){if(!document.querySelector(".dp-overlay")){const t=document.createElement("div");t.className="dp-overlay",document.body.appendChild(t)}}attachEventListeners(){const t=this.config.mode;this._onInputClick=()=>this.show(),this._onInputKeydown=t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.show()),"Escape"===t.key&&this.picker.classList.contains("show")&&(t.preventDefault(),this.hide())},this._onDocumentClick=t=>{this.wrapper.contains(t.target)||this.picker.contains(t.target)||this.hide()},this.input.addEventListener("click",this._onInputClick),this.input.addEventListener("keydown",this._onInputKeydown),"date"!==t&&"datetime"!==t||(this.prevButton.addEventListener("click",t=>{t.stopPropagation(),this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()-1,1),this.updateCalendar()}),this.nextButton.addEventListener("click",t=>{t.stopPropagation(),this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()+1,1),this.updateCalendar()}),this.todayButton.addEventListener("click",e=>{e.stopPropagation();const a=new Date;this.isDisabled(a)||(this.selectedDate=a,this.viewDate=new Date,this.updateCalendar(),this.setInputValue(),"date"===t&&(this.hide(),this.input.focus()))}),this.clearButton.addEventListener("click",e=>{e.stopPropagation(),this.selectedDate=null,this.selectedHour=null,this.selectedMinute=null,this.input.value="",this.input.dispatchEvent(new Event("change",{bubbles:!0})),this.updateCalendar(),"datetime"===t&&(this.hourColumn&&this.hourColumn.querySelectorAll(".dp-hour-item").forEach(t=>{t.classList.remove("selected"),t.setAttribute("aria-selected",!1)}),this.minuteColumn&&this.minuteColumn.querySelectorAll(".dp-minute-item").forEach(t=>{t.classList.remove("selected"),t.setAttribute("aria-selected",!1)})),this.hide(),this.input.focus()}),this.calendarGrid.addEventListener("keydown",t=>{const e=Array.from(this.calendarGrid.querySelectorAll(".calendar-day:not(.disabled)")),a=e.indexOf(document.activeElement);if(-1===a)return;let i=-1;switch(t.key){case"ArrowRight":if(t.preventDefault(),i=a+1,i>=e.length)return this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()+1,1),this.updateCalendar(),void this.focusDayByIndex(0);break;case"ArrowLeft":if(t.preventDefault(),i=a-1,i<0)return this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()-1,1),this.updateCalendar(),void this.focusDayByIndex(-1);break;case"ArrowDown":if(t.preventDefault(),i=a+7,i>=e.length)return this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()+1,1),this.updateCalendar(),void this.focusDayByIndex(0);break;case"ArrowUp":if(t.preventDefault(),i=a-7,i<0)return this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()-1,1),this.updateCalendar(),void this.focusDayByIndex(-1);break;case"Home":t.preventDefault(),i=0;break;case"End":t.preventDefault(),i=e.length-1;break;case"PageUp":return t.preventDefault(),this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()-1,1),this.updateCalendar(),void this.focusDayByIndex(Math.min(a,this.getEnabledDayCount()-1));case"PageDown":return t.preventDefault(),this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()+1,1),this.updateCalendar(),void this.focusDayByIndex(Math.min(a,this.getEnabledDayCount()-1));case"Enter":case" ":return t.preventDefault(),void e[a].click();default:return}i>=0&&i<e.length&&e[i].focus()})),"time"!==t&&"datetime"!==t||(this.hourColumn.addEventListener("click",t=>{t.stopPropagation(),t.target.classList.contains("dp-hour-item")&&this.selectHour(t.target.dataset.value)}),this.minuteColumn.addEventListener("click",t=>{t.stopPropagation(),t.target.classList.contains("dp-minute-item")&&this.selectMinute(t.target.dataset.value)})),document.addEventListener("click",this._onDocumentClick),this.picker.addEventListener("keydown",t=>{"Escape"===t.key&&(t.preventDefault(),this.hide(),this.input.focus())}),this.picker.addEventListener("keydown",t=>{if("Tab"!==t.key)return;const e=this.picker.querySelectorAll('button:not([disabled]):not([tabindex="-1"])');if(0===e.length)return;const a=e[0],i=e[e.length-1];t.shiftKey&&document.activeElement===a?(t.preventDefault(),i.focus()):t.shiftKey||document.activeElement!==i||(t.preventDefault(),a.focus())})}focusDayByIndex(t){const e=this.calendarGrid.querySelectorAll(".calendar-day:not(.disabled)");if(0===e.length)return;const a=t<0?e.length+t:t;e[Math.max(0,Math.min(a,e.length-1))].focus()}getEnabledDayCount(){return this.calendarGrid.querySelectorAll(".calendar-day:not(.disabled)").length}show(){const t=this.config.mode;if(e.instances.forEach(t=>{t!==this&&t.closePicker()}),"date"!==t&&"datetime"!==t||this.updateCalendar(),this.picker.classList.add("show"),document.querySelector(".dp-overlay").classList.add("show"),"time"!==t&&"datetime"!==t||this._initTimeOnShow(),"date"===t||"datetime"===t){const t=this.calendarGrid.querySelector(".calendar-day.selected:not(.disabled)"),e=this.calendarGrid.querySelector(".calendar-day.today:not(.disabled)"),a=this.calendarGrid.querySelector(".calendar-day:not(.disabled):not(.other-month)"),i=t||e||a;i&&i.focus()}}_initTimeOnShow(){const t=this.input.value;let e=null,a=null;if(t){const i=this.config.mode;if("time"===i){const i=t.match(/(\d{2}):(\d{2})/);i&&(e=i[1],a=i[2])}else if("datetime"===i){const i=t.match(/(\d{2}):(\d{2})$/);i&&(e=i[1],a=i[2])}}if(!e||!a){const t=new Date;e=t.getHours().toString().padStart(2,"0");const i=t.getMinutes(),n=this.config.minuteStep;a=(Math.round(i/n)*n%60).toString().padStart(2,"0")}this.selectHour(e),this.selectMinute(a),setTimeout(()=>{this.scrollToTimeSelection(this.hourColumn),this.scrollToTimeSelection(this.minuteColumn)},10)}closePicker(){this.picker.classList.remove("show")}hide(){this.picker.classList.remove("show");e.instances.some(t=>t.picker.classList.contains("show"))||document.querySelector(".dp-overlay").classList.remove("show")}updateCalendar(){const t=this.viewDate.getFullYear(),e=this.viewDate.getMonth();this.monthYearDisplay.textContent=`${t}年${e+1}月`,this.clearButton.disabled=!this.selectedDate&&null===this.selectedHour,this.calendarGrid.innerHTML="";["日","月","火","水","木","金","土"].forEach((t,e)=>{const a=document.createElement("div");a.className="weekday-header",0===e&&a.classList.add("sunday"),6===e&&a.classList.add("saturday"),a.textContent=t,a.setAttribute("role","columnheader"),this.calendarGrid.appendChild(a)});const a=new Date(t,e,1),i=new Date(t,e+1,0),n=new Date(t,e,0),o=a.getDay();for(let a=o-1;a>=0;a--){const i=n.getDate()-a;this.createDayElement(new Date(t,e-1,i),!0)}for(let a=1;a<=i.getDate();a++)this.createDayElement(new Date(t,e,a),!1);const s=42-(o+i.getDate());for(let a=1;a<=s;a++)this.createDayElement(new Date(t,e+1,a),!0)}createDayElement(t,e){const a=this.config.mode,i=document.createElement("button");i.className="calendar-day",i.textContent=t.getDate(),i.setAttribute("type","button");const n=t.getDay();0===n&&i.classList.add("sunday"),6===n&&i.classList.add("saturday"),this.isHoliday(t)&&i.classList.add("holiday"),e&&i.classList.add("other-month"),this.isToday(t)&&i.classList.add("today"),this.selectedDate&&this.isSameDay(t,this.selectedDate)&&(i.classList.add("selected"),i.setAttribute("aria-selected","true"));this.isDisabled(t)?(i.classList.add("disabled"),i.setAttribute("disabled","true"),i.setAttribute("tabindex","-1")):(i.setAttribute("tabindex",e?"-1":"0"),i.addEventListener("click",e=>{e.stopPropagation(),this.selectedDate=t,this.viewDate=new Date(t),this.updateCalendar(),this.setInputValue(),"date"===a&&(this.hide(),this.input.focus())})),this.calendarGrid.appendChild(i)}isToday(t){return this.isSameDay(t,new Date)}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}isHoliday(t){const e=`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`;return this.holidays.has(e)}setInputValue(){const t=this.config.mode;if("time"===t)return void(null!==this.selectedHour&&null!==this.selectedMinute&&(this.input.value=`${this.selectedHour}:${this.selectedMinute}`,this.input.dispatchEvent(new Event("change",{bubbles:!0}))));if("datetime"===t){if(!this.selectedDate)return;const t=this.selectedDate.getFullYear(),e=String(this.selectedDate.getMonth()+1).padStart(2,"0"),a=String(this.selectedDate.getDate()).padStart(2,"0"),i=null!==this.selectedHour&&null!==this.selectedMinute?` ${this.selectedHour}:${this.selectedMinute}`:"";return this.input.value=`${t}/${e}/${a}${i}`,void this.input.dispatchEvent(new Event("change",{bubbles:!0}))}if(!this.selectedDate)return;const e=this.selectedDate.getFullYear(),a=String(this.selectedDate.getMonth()+1).padStart(2,"0"),i=String(this.selectedDate.getDate()).padStart(2,"0");let n=this.config.format.replace("YYYY",e).replace("MM",a).replace("DD",i);this.input.value=n,this.input.dispatchEvent(new Event("change",{bubbles:!0}))}destroy(){this.hide(),document.removeEventListener("click",this._onDocumentClick),this.input.removeEventListener("click",this._onInputClick),this.input.removeEventListener("keydown",this._onInputKeydown),this.picker.remove();const t=e.instances.indexOf(this);if(-1!==t&&e.instances.splice(t,1),0===e.instances.length){const t=document.querySelector(".dp-overlay");t&&t.remove()}}}if("undefined"!=typeof document){const t=function(){const t=document.currentScript||(()=>{const t=document.querySelectorAll("script[src]");return t[t.length-1]})();return t&&t.src?t.src.substring(0,t.src.lastIndexOf("/")+1):""}()+"holiday.csv",a=t=>{document.querySelectorAll(".date-picker-wrapper").forEach(a=>{const i={holidays:t};a.dataset.minDate&&(i.minDate=a.dataset.minDate),a.dataset.maxDate&&(i.maxDate=a.dataset.maxDate),a.dataset.format&&(i.format=a.dataset.format),a.dataset.mode&&(i.mode=a.dataset.mode),a.dataset.minuteStep&&(i.minuteStep=parseInt(a.dataset.minuteStep,10)||30),new e(a,i)})},i=()=>{fetch(t).then(t=>{if(!t.ok)throw new Error(t.status);return t.text()}).then(t=>function(t){const e=new Set,a=/^(\d{4}\/\d{1,2}\/\d{1,2})/,i=t.split(/\r?\n/);for(const t of i){const i=t.match(a);i&&e.add(i[1])}return e}(t)).catch(()=>new Set).then(t=>a(t))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()}t.DateTimePicker=e}(this.DateTimePicker=this.DateTimePicker||{});
