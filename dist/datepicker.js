!function(t){"use strict";!function(t,e){void 0===e&&(e={});var a=e.insertAt;if("undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===a&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}(':root{--dp-primary-color:#06c;--dp-sunday-color:#d63638;--dp-saturday-color:#06c;--dp-bg-color:#fff;--dp-text-color:#333;--dp-hover-bg:#f0f0f0;--dp-border-radius:8px;--dp-shadow:0 4px 20px rgba(0,0,0,.15)}.date-input-container{margin-bottom:20px}.date-input{background-color:#fff;background-image:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="%23666" stroke-width="1.5" fill="none"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8"  y1="2" x2="8"  y2="6"/><line x1="3"  y1="10" x2="21" y2="10"/></svg>\');background-position:right 10px center;background-repeat:no-repeat;background-size:14px 14px;border:1px solid #ccc;border-radius:4px;cursor:pointer;font-size:14px;padding:8px 32px 8px 12px;width:200px}.date-picker-wrapper{display:inline-block;position:relative}.date-picker{background:var(--dp-bg-color);border-radius:var(--dp-border-radius);box-shadow:var(--dp-shadow);display:none;left:0;margin-top:4px;padding:12px;position:absolute;top:100%;width:280px;z-index:1000}.date-picker.show{display:block}.date-picker-controls{align-items:center;display:flex;justify-content:space-between;margin-bottom:12px;position:relative}.month-navigation{align-items:center;display:flex;gap:4px;left:50%;position:absolute;transform:translateX(-50%)}.today-button{background:#e6f2ff;border:none;border-radius:4px;color:var(--dp-primary-color);cursor:pointer;font-size:11px;margin-left:auto;padding:4px 12px;transition:background-color .2s}.today-button:hover{background-color:#cce5ff}.nav-button{align-items:center;background:transparent;border:none;border-radius:4px;color:#666;cursor:pointer;display:flex;flex-shrink:0;font-size:16px;height:24px;justify-content:center;transition:background-color .2s;width:24px}.nav-button:hover{background-color:var(--dp-hover-bg)}.month-year-display{color:var(--dp-text-color);font-size:14px;font-weight:500;text-align:center;white-space:nowrap}.calendar-day.sunday:not(.other-month),.weekday-header.sunday{color:var(--dp-sunday-color)}.calendar-day.saturday:not(.other-month),.weekday-header.saturday{color:var(--dp-saturday-color)}.calendar-grid{display:grid;gap:2px;grid-template-columns:repeat(7,1fr)}.weekday-header{color:#666;font-size:11px;font-weight:500;padding:4px 0;text-align:center}.calendar-day{align-items:center;aspect-ratio:1;background:transparent;border:none;border-radius:50%;cursor:pointer;display:flex;font-size:13px;justify-content:center;min-height:32px;padding:0;position:relative;transition:all .2s}.calendar-day:hover:not(.other-month):not(.selected){background-color:var(--dp-hover-bg)}.calendar-day.other-month{color:#ccc}.calendar-day.disabled,.calendar-day.disabled.saturday,.calendar-day.disabled.sunday{color:#ccc;cursor:not-allowed;pointer-events:none}.calendar-day.disabled:hover{background-color:transparent}.calendar-day.selected{background-color:var(--dp-primary-color);color:#fff;font-weight:500}.calendar-day.selected.sunday{background-color:var(--dp-sunday-color);color:#fff}.calendar-day.selected.saturday{color:#fff}.calendar-day.holiday:not(.other-month){color:var(--dp-sunday-color)}.calendar-day.holiday.selected{background-color:var(--dp-sunday-color);color:#fff}.calendar-day.disabled.holiday{color:#ccc}.calendar-day.today:not(.selected){font-weight:600}.calendar-day.today:not(.selected).sunday{color:var(--dp-sunday-color)}.calendar-day.today:not(.selected).saturday{color:var(--dp-saturday-color)}.calendar-day.today:not(.selected):after{background-color:currentColor;border-radius:50%;bottom:2px;content:"";height:3px;left:50%;position:absolute;transform:translateX(-50%);width:3px}.dp-overlay{display:none;inset:0;position:fixed;z-index:999}.dp-overlay.show{display:block}@media (max-width:768px){.date-picker{padding:10px;width:260px}.calendar-day{font-size:12px;min-height:28px}.nav-button{font-size:14px;height:20px;width:20px}.month-year-display{font-size:13px}.today-button{font-size:10px;padding:3px 8px}}');class e{static instances=[];constructor(t,a={}){this.wrapper=t,this.input=t.querySelector(".date-input"),this.config={format:"YYYY/MM/DD",minDate:null,maxDate:null,...a},this.minDate=this.parseDate(this.config.minDate),this.maxDate=this.parseDate(this.config.maxDate),this.holidays=a.holidays instanceof Set?a.holidays:new Set(a.holidays||[]),this.selectedDate=null,this.viewDate=new Date,e.instances.push(this),this.init()}parseDate(t){if(!t)return null;if("today"===t){const t=new Date;return t.setHours(0,0,0,0),t}if(t instanceof Date)return t;const e=String(t).match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(e)return new Date(parseInt(e[1]),parseInt(e[2])-1,parseInt(e[3]));const a=new Date(t);return isNaN(a)?null:a}isDisabled(t){const e=new Date(t);if(e.setHours(0,0,0,0),this.minDate){const t=new Date(this.minDate);if(t.setHours(0,0,0,0),e<t)return!0}if(this.maxDate){const t=new Date(this.maxDate);if(t.setHours(0,0,0,0),e>t)return!0}return!1}init(){this.createPicker(),this.attachEventListeners()}createPicker(){const t=document.createElement("div");t.className="date-picker",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-label","Date Picker"),t.innerHTML='\n            <div class="date-picker-controls">\n                <div class="month-navigation">\n                    <button type="button" class="nav-button prev-month" aria-label="Previous Month">‹</button>\n                    <div class="month-year-display" aria-live="polite"></div>\n                    <button type="button" class="nav-button next-month" aria-label="Next Month">›</button>\n                </div>\n                <button type="button" class="today-button">今日</button>\n            </div>\n            <div class="calendar-grid" role="grid"></div>\n        ',this.wrapper.appendChild(t),this.picker=t,this.monthYearDisplay=t.querySelector(".month-year-display"),this.calendarGrid=t.querySelector(".calendar-grid"),this.prevButton=t.querySelector(".prev-month"),this.nextButton=t.querySelector(".next-month"),this.todayButton=t.querySelector(".today-button"),this.createOverlay()}createOverlay(){if(!document.querySelector(".dp-overlay")){const t=document.createElement("div");t.className="dp-overlay",document.body.appendChild(t)}}attachEventListeners(){this._onInputClick=()=>this.show(),this._onInputKeydown=t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.show()),"Escape"===t.key&&this.picker.classList.contains("show")&&(t.preventDefault(),this.hide())},this._onDocumentClick=t=>{this.wrapper.contains(t.target)||this.picker.contains(t.target)||this.hide()},this.input.addEventListener("click",this._onInputClick),this.input.addEventListener("keydown",this._onInputKeydown),this.prevButton.addEventListener("click",t=>{t.stopPropagation(),this.viewDate.setMonth(this.viewDate.getMonth()-1),this.updateCalendar()}),this.nextButton.addEventListener("click",t=>{t.stopPropagation(),this.viewDate.setMonth(this.viewDate.getMonth()+1),this.updateCalendar()}),this.todayButton.addEventListener("click",t=>{t.stopPropagation();const e=new Date;this.isDisabled(e)||(this.selectedDate=e,this.viewDate=new Date,this.updateCalendar(),this.setInputValue(),this.hide(),this.input.focus())}),document.addEventListener("click",this._onDocumentClick),this.picker.addEventListener("keydown",t=>{"Escape"===t.key&&(t.preventDefault(),this.hide(),this.input.focus())}),this.picker.addEventListener("keydown",t=>{if("Tab"!==t.key)return;const e=this.picker.querySelectorAll('button:not([disabled]):not([tabindex="-1"])');if(0===e.length)return;const a=e[0],n=e[e.length-1];t.shiftKey&&document.activeElement===a?(t.preventDefault(),n.focus()):t.shiftKey||document.activeElement!==n||(t.preventDefault(),a.focus())}),this.calendarGrid.addEventListener("keydown",t=>{const e=Array.from(this.calendarGrid.querySelectorAll(".calendar-day:not(.disabled)")),a=e.indexOf(document.activeElement);if(-1===a)return;let n=-1;switch(t.key){case"ArrowRight":if(t.preventDefault(),n=a+1,n>=e.length)return this.viewDate.setMonth(this.viewDate.getMonth()+1),this.updateCalendar(),void this.focusDayByIndex(0);break;case"ArrowLeft":if(t.preventDefault(),n=a-1,n<0)return this.viewDate.setMonth(this.viewDate.getMonth()-1),this.updateCalendar(),void this.focusDayByIndex(-1);break;case"ArrowDown":if(t.preventDefault(),n=a+7,n>=e.length)return this.viewDate.setMonth(this.viewDate.getMonth()+1),this.updateCalendar(),void this.focusDayByIndex(0);break;case"ArrowUp":if(t.preventDefault(),n=a-7,n<0)return this.viewDate.setMonth(this.viewDate.getMonth()-1),this.updateCalendar(),void this.focusDayByIndex(-1);break;case"Home":t.preventDefault(),n=0;break;case"End":t.preventDefault(),n=e.length-1;break;case"PageUp":return t.preventDefault(),this.viewDate.setMonth(this.viewDate.getMonth()-1),this.updateCalendar(),void this.focusDayByIndex(Math.min(a,this.getEnabledDayCount()-1));case"PageDown":return t.preventDefault(),this.viewDate.setMonth(this.viewDate.getMonth()+1),this.updateCalendar(),void this.focusDayByIndex(Math.min(a,this.getEnabledDayCount()-1));case"Enter":case" ":return t.preventDefault(),void e[a].click();default:return}n>=0&&n<e.length&&e[n].focus()})}focusDayByIndex(t){const e=this.calendarGrid.querySelectorAll(".calendar-day:not(.disabled)");if(0===e.length)return;const a=t<0?e.length+t:t;e[Math.max(0,Math.min(a,e.length-1))].focus()}getEnabledDayCount(){return this.calendarGrid.querySelectorAll(".calendar-day:not(.disabled)").length}show(){e.instances.forEach(t=>{t!==this&&t.closePicker()}),this.updateCalendar(),this.picker.classList.add("show"),document.querySelector(".dp-overlay").classList.add("show");const t=this.calendarGrid.querySelector(".calendar-day.selected:not(.disabled)"),a=this.calendarGrid.querySelector(".calendar-day.today:not(.disabled)"),n=this.calendarGrid.querySelector(".calendar-day:not(.disabled):not(.other-month)"),r=t||a||n;r&&r.focus()}closePicker(){this.picker.classList.remove("show")}hide(){this.picker.classList.remove("show");e.instances.some(t=>t.picker.classList.contains("show"))||document.querySelector(".dp-overlay").classList.remove("show")}updateCalendar(){const t=this.viewDate.getFullYear(),e=this.viewDate.getMonth();this.monthYearDisplay.textContent=`${t}年${e+1}月`,this.calendarGrid.innerHTML="";["日","月","火","水","木","金","土"].forEach((t,e)=>{const a=document.createElement("div");a.className="weekday-header",0===e&&a.classList.add("sunday"),6===e&&a.classList.add("saturday"),a.textContent=t,a.setAttribute("role","columnheader"),this.calendarGrid.appendChild(a)});const a=new Date(t,e,1),n=new Date(t,e+1,0),r=new Date(t,e,0),i=a.getDay();for(let a=i-1;a>=0;a--){const n=r.getDate()-a;this.createDayElement(new Date(t,e-1,n),!0)}for(let a=1;a<=n.getDate();a++)this.createDayElement(new Date(t,e,a),!1);const s=42-(i+n.getDate());for(let a=1;a<=s;a++)this.createDayElement(new Date(t,e+1,a),!0)}createDayElement(t,e){const a=document.createElement("button");a.className="calendar-day",a.textContent=t.getDate(),a.setAttribute("type","button");const n=t.getDay();0===n&&a.classList.add("sunday"),6===n&&a.classList.add("saturday"),this.isHoliday(t)&&a.classList.add("holiday"),e&&a.classList.add("other-month"),this.isToday(t)&&a.classList.add("today"),this.selectedDate&&this.isSameDay(t,this.selectedDate)&&(a.classList.add("selected"),a.setAttribute("aria-selected","true"));this.isDisabled(t)?(a.classList.add("disabled"),a.setAttribute("disabled","true"),a.setAttribute("tabindex","-1")):(a.setAttribute("tabindex",e?"-1":"0"),a.addEventListener("click",e=>{e.stopPropagation(),this.selectedDate=t,this.viewDate=new Date(t),this.updateCalendar(),this.setInputValue(),this.hide(),this.input.focus()})),this.calendarGrid.appendChild(a)}isToday(t){return this.isSameDay(t,new Date)}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}isHoliday(t){const e=`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`;return this.holidays.has(e)}setInputValue(){if(!this.selectedDate)return;const t=this.selectedDate.getFullYear(),e=String(this.selectedDate.getMonth()+1).padStart(2,"0"),a=String(this.selectedDate.getDate()).padStart(2,"0");let n=this.config.format.replace("YYYY",t).replace("MM",e).replace("DD",a);this.input.value=n,this.input.dispatchEvent(new Event("change",{bubbles:!0}))}destroy(){this.hide(),document.removeEventListener("click",this._onDocumentClick),this.input.removeEventListener("click",this._onInputClick),this.input.removeEventListener("keydown",this._onInputKeydown),this.picker.remove();const t=e.instances.indexOf(this);if(-1!==t&&e.instances.splice(t,1),0===e.instances.length){const t=document.querySelector(".dp-overlay");t&&t.remove()}}}if("undefined"!=typeof document){const t=function(){const t=document.currentScript||(()=>{const t=document.querySelectorAll("script[src]");return t[t.length-1]})();return t&&t.src?t.src.substring(0,t.src.lastIndexOf("/")+1):""}()+"holiday.csv",a=t=>{document.querySelectorAll(".date-picker-wrapper").forEach(a=>{const n={holidays:t};a.dataset.minDate&&(n.minDate=a.dataset.minDate),a.dataset.maxDate&&(n.maxDate=a.dataset.maxDate),a.dataset.format&&(n.format=a.dataset.format),new e(a,n)})},n=()=>{fetch(t).then(t=>{if(!t.ok)throw new Error(t.status);return t.text()}).then(t=>function(t){const e=new Set,a=/^(\d{4}\/\d{1,2}\/\d{1,2})/,n=t.split(/\r?\n/);for(const t of n){const n=t.match(a);n&&e.add(n[1])}return e}(t)).catch(()=>new Set).then(t=>a(t))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}t.DatePicker=e}(this.DatePicker=this.DatePicker||{});
